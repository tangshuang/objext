<!DOCTYPE html>
<title>测试版本控制</title>

<div>
  <p id="text"></p>
  <p>
    年龄：<input type="number" value="" id="input" />
  </p>
  <p>
    <button id="commit">创建版本</button>
    <button id="reset">恢复版本</button>
    <button id="clone">克隆一个新的</button>
  </p>
</div>

<script src="../dist/objext.js"></script>
<script>
const { Objext } = window.objext
const origin = {
  name: 'tomy',
  age: 10,
  get info() {
    return this.name + ': ' + this.age
  },
}
var objx = new Objext(origin)
var get = () => objx

function render() {
  let objx = get()
  let info = objx.info
  let age = objx.age
  document.querySelector('#text').innerHTML = info
  document.querySelector('#input').value = age
}

document.querySelector('#input').addEventListener('input', (e) => {
  let objx = get()
  let value = e.target.value
  objx.age = value
  render()
})

document.querySelector('#commit').addEventListener('click', () => {
  let objx = get()
  objx.$commit('version')
  render()
})

document.querySelector('#reset').addEventListener('click', () => {
  let objx = get()
  objx.$reset('version')
  render()
})

document.querySelector('#clone').addEventListener('click', () => {
  let objx = get()
  objx = objx.$clone()
  render()
})

render()
</script>
